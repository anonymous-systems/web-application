import { ChangeDetectionStrategy, Component, EventEmitter, Input, Output, } from '@angular/core';
import { StorageItemIconComponent, } from '../storage-item-icon/storage-item-icon.component';
import { MatTooltipModule } from '@angular/material/tooltip';
import { MatButtonModule } from '@angular/material/button';
import { MatIconModule } from '@angular/material/icon';
import { FormatBytesPipe } from '../../pipes/format-bytes.pipe';
import { DatePipe, NgOptimizedImage } from '@angular/common';
import * as i0 from "@angular/core";
import * as i1 from "@angular/cdk/clipboard";
import * as i2 from "../../services/console-logger.service";
import * as i3 from "../../services/firebase-storage.service";
import * as i4 from "@angular/material/tooltip";
import * as i5 from "@angular/material/button";
import * as i6 from "@angular/material/icon";
export class StorageFilePreviewComponent {
    constructor(clipboard, cLog, storageService) {
        this.clipboard = clipboard;
        this.cLog = cLog;
        this.storageService = storageService;
        /**
         * Emits an event when the preview should be closed.
         * @event
         */
        this._close = new EventEmitter();
        /**
         * Indicates whether an error occurred while generating the file preview URL.
         */
        this.previewError = false;
    }
    ngOnChanges() {
        if (!this.item)
            return;
        /**
         * Fetches the download URL for the new file and updates the preview state.
         */
        const fileRef = this.storageService.getRef(this.item.fullPath);
        this.storageService.getDownloadURL(fileRef)
            .then((downloadURL) => {
            this.previewError = false;
            this.downloadURL = downloadURL;
        }).catch((error) => {
            this.cLog.error(`Error getting download URL for '${this.item?.name}'`, error, this.item);
        });
    }
    /**
     * Emits the '_close' event to signal that the preview should be closed.
     */
    closePreview() {
        this._close.emit(undefined);
    }
    onCopy() {
        if (this.downloadURL) {
            const success = this.clipboard.copy(this.downloadURL);
            if (success)
                this.cLog.info('Copied to clipboard');
            else
                this.cLog.info('Error copying to clipboard');
        }
    }
    static { this.ɵfac = i0.ɵɵngDeclareFactory({ minVersion: "12.0.0", version: "18.1.3", ngImport: i0, type: StorageFilePreviewComponent, deps: [{ token: i1.Clipboard }, { token: i2.ConsoleLoggerService }, { token: i3.FirebaseStorageService }], target: i0.ɵɵFactoryTarget.Component }); }
    static { this.ɵcmp = i0.ɵɵngDeclareComponent({ minVersion: "17.0.0", version: "18.1.3", type: StorageFilePreviewComponent, isStandalone: true, selector: "anon-storage-file-preview", inputs: { item: "item" }, outputs: { _close: "_close" }, usesOnChanges: true, ngImport: i0, template: "@if (item) {\n  <div class=\"header\">\n    <div class=\"name\">\n      <anon-storage-item-icon [type]=\"item.type!\" [contentType]=\"item.contentType!\" />\n      <span matTooltipShowDelay=\"500\" [matTooltip]=\"item.name\">{{item.name}}</span>\n    </div>\n\n    <button mat-icon-button type=\"button\" (click)=\"closePreview()\">\n      <mat-icon fontIcon=\"close\" />\n    </button>\n  </div>\n\n  @if (downloadURL) {\n     \n    @if (item.contentType?.startsWith('image/')) {\n      <picture class=\"file-preview\">\n        <img fill [ngSrc]=\"downloadURL\" [alt]=\"item.fullPath\"\n             (error)=\"downloadURL=undefined;previewError=true\" />\n      </picture>\n       \n    } @else if (item.contentType?.startsWith('video/')) {\n      <video class=\"file-preview\" controls autoplay loop>\n        <source [type]=\"item.contentType\" [src]=\"downloadURL\"\n                (error)=\"downloadURL=undefined;previewError=true\"/>\n      </video>\n    }\n\n    <div class=\"btn-container\">\n      <div class=\"download-btn\">\n        <a mat-stroked-button type=\"button\" color=\"primary\" target=\"_blank\" [href]=\"downloadURL\">\n          <mat-icon fontIcon=\"download\" />\n          <span>Download</span>\n        </a>\n      </div>\n\n      <div class=\"copy-btn\">\n        <button mat-stroked-button type=\"button\" color=\"primary\" (click)=\"onCopy()\">\n          <mat-icon fontIcon=\"file_copy\" />\n          <span>Copy</span>\n        </button>\n      </div>\n    </div>\n  }\n  @if (previewError) {\n    <h3 class=\"file-preview\">Preview Not Available.</h3>\n  }\n\n  <dl class=\"metadata\">\n    <dt>Name</dt>\n    <dd><a class=\"download-link\" target=\"_blank\" [href]=\"downloadURL\">{{item.name}}</a></dd>\n\n    <dt>Size</dt>\n    <dd>{{item.size | formatBytes}}</dd>\n\n    <dt>Type</dt>\n    <dd>{{item.contentType}}</dd>\n\n    <dt>Created</dt>\n    <dd>{{item.timeCreated | date:'short'}}</dd>\n\n    <dt>Last modified</dt>\n    <dd>{{item.updated | date:'short'}}</dd>\n  </dl>\n}\n", styles: [":host{display:block;margin-left:-1.5rem;flex-shrink:0;border-left-width:1px;border-left-style:solid;height:100%}.header{display:flex;justify-content:space-between;align-items:center;padding:.5rem 1.5rem}.header .name{display:flex;align-items:center;overflow:hidden}.header .name span{display:inline-block;flex-grow:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.file-preview{display:grid;place-content:center;max-width:100%;max-height:250px;padding:.5rem 1.5rem;box-sizing:border-box}.file-preview img{position:relative!important}.metadata{padding:0 1.5rem .5rem}.download-link{overflow-wrap:break-word}.btn-container{display:flex;flex-wrap:wrap;justify-content:center;gap:1rem}\n"], dependencies: [{ kind: "component", type: StorageItemIconComponent, selector: "anon-storage-item-icon", inputs: ["type", "contentType"] }, { kind: "ngmodule", type: MatTooltipModule }, { kind: "directive", type: i4.MatTooltip, selector: "[matTooltip]", inputs: ["matTooltipPosition", "matTooltipPositionAtOrigin", "matTooltipDisabled", "matTooltipShowDelay", "matTooltipHideDelay", "matTooltipTouchGestures", "matTooltip", "matTooltipClass"], exportAs: ["matTooltip"] }, { kind: "ngmodule", type: MatButtonModule }, { kind: "component", type: i5.MatAnchor, selector: "a[mat-button], a[mat-raised-button], a[mat-flat-button], a[mat-stroked-button]", exportAs: ["matButton", "matAnchor"] }, { kind: "component", type: i5.MatButton, selector: "    button[mat-button], button[mat-raised-button], button[mat-flat-button],    button[mat-stroked-button]  ", exportAs: ["matButton"] }, { kind: "component", type: i5.MatIconButton, selector: "button[mat-icon-button]", exportAs: ["matButton"] }, { kind: "ngmodule", type: MatIconModule }, { kind: "component", type: i6.MatIcon, selector: "mat-icon", inputs: ["color", "inline", "svgIcon", "fontSet", "fontIcon"], exportAs: ["matIcon"] }, { kind: "pipe", type: FormatBytesPipe, name: "formatBytes" }, { kind: "pipe", type: DatePipe, name: "date" }, { kind: "directive", type: NgOptimizedImage, selector: "img[ngSrc]", inputs: ["ngSrc", "ngSrcset", "sizes", "width", "height", "loading", "priority", "loaderParams", "disableOptimizedSrcset", "fill", "placeholder", "placeholderConfig", "src", "srcset"] }], changeDetection: i0.ChangeDetectionStrategy.OnPush }); }
}
i0.ɵɵngDeclareClassMetadata({ minVersion: "12.0.0", version: "18.1.3", ngImport: i0, type: StorageFilePreviewComponent, decorators: [{
            type: Component,
            args: [{ selector: 'anon-storage-file-preview', standalone: true, imports: [
                        StorageItemIconComponent,
                        MatTooltipModule,
                        MatButtonModule,
                        MatIconModule,
                        FormatBytesPipe,
                        DatePipe,
                        NgOptimizedImage,
                    ], changeDetection: ChangeDetectionStrategy.OnPush, template: "@if (item) {\n  <div class=\"header\">\n    <div class=\"name\">\n      <anon-storage-item-icon [type]=\"item.type!\" [contentType]=\"item.contentType!\" />\n      <span matTooltipShowDelay=\"500\" [matTooltip]=\"item.name\">{{item.name}}</span>\n    </div>\n\n    <button mat-icon-button type=\"button\" (click)=\"closePreview()\">\n      <mat-icon fontIcon=\"close\" />\n    </button>\n  </div>\n\n  @if (downloadURL) {\n     \n    @if (item.contentType?.startsWith('image/')) {\n      <picture class=\"file-preview\">\n        <img fill [ngSrc]=\"downloadURL\" [alt]=\"item.fullPath\"\n             (error)=\"downloadURL=undefined;previewError=true\" />\n      </picture>\n       \n    } @else if (item.contentType?.startsWith('video/')) {\n      <video class=\"file-preview\" controls autoplay loop>\n        <source [type]=\"item.contentType\" [src]=\"downloadURL\"\n                (error)=\"downloadURL=undefined;previewError=true\"/>\n      </video>\n    }\n\n    <div class=\"btn-container\">\n      <div class=\"download-btn\">\n        <a mat-stroked-button type=\"button\" color=\"primary\" target=\"_blank\" [href]=\"downloadURL\">\n          <mat-icon fontIcon=\"download\" />\n          <span>Download</span>\n        </a>\n      </div>\n\n      <div class=\"copy-btn\">\n        <button mat-stroked-button type=\"button\" color=\"primary\" (click)=\"onCopy()\">\n          <mat-icon fontIcon=\"file_copy\" />\n          <span>Copy</span>\n        </button>\n      </div>\n    </div>\n  }\n  @if (previewError) {\n    <h3 class=\"file-preview\">Preview Not Available.</h3>\n  }\n\n  <dl class=\"metadata\">\n    <dt>Name</dt>\n    <dd><a class=\"download-link\" target=\"_blank\" [href]=\"downloadURL\">{{item.name}}</a></dd>\n\n    <dt>Size</dt>\n    <dd>{{item.size | formatBytes}}</dd>\n\n    <dt>Type</dt>\n    <dd>{{item.contentType}}</dd>\n\n    <dt>Created</dt>\n    <dd>{{item.timeCreated | date:'short'}}</dd>\n\n    <dt>Last modified</dt>\n    <dd>{{item.updated | date:'short'}}</dd>\n  </dl>\n}\n", styles: [":host{display:block;margin-left:-1.5rem;flex-shrink:0;border-left-width:1px;border-left-style:solid;height:100%}.header{display:flex;justify-content:space-between;align-items:center;padding:.5rem 1.5rem}.header .name{display:flex;align-items:center;overflow:hidden}.header .name span{display:inline-block;flex-grow:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.file-preview{display:grid;place-content:center;max-width:100%;max-height:250px;padding:.5rem 1.5rem;box-sizing:border-box}.file-preview img{position:relative!important}.metadata{padding:0 1.5rem .5rem}.download-link{overflow-wrap:break-word}.btn-container{display:flex;flex-wrap:wrap;justify-content:center;gap:1rem}\n"] }]
        }], ctorParameters: () => [{ type: i1.Clipboard }, { type: i2.ConsoleLoggerService }, { type: i3.FirebaseStorageService }], propDecorators: { item: [{
                type: Input
            }], _close: [{
                type: Output
            }] } });
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoic3RvcmFnZS1maWxlLXByZXZpZXcuY29tcG9uZW50LmpzIiwic291cmNlUm9vdCI6IiIsInNvdXJjZXMiOlsiLi4vLi4vLi4vLi4vLi4vLi4vcHJvamVjdHMvYW5ndWxhci1maXJlYmFzZS1zdG9yYWdlLW1hbmFnZXIvc3JjL2xpYi9jb21wb25lbnRzL3N0b3JhZ2UtZmlsZS1wcmV2aWV3L3N0b3JhZ2UtZmlsZS1wcmV2aWV3LmNvbXBvbmVudC50cyIsIi4uLy4uLy4uLy4uLy4uLy4uL3Byb2plY3RzL2FuZ3VsYXItZmlyZWJhc2Utc3RvcmFnZS1tYW5hZ2VyL3NyYy9saWIvY29tcG9uZW50cy9zdG9yYWdlLWZpbGUtcHJldmlldy9zdG9yYWdlLWZpbGUtcHJldmlldy5jb21wb25lbnQuaHRtbCJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxPQUFPLEVBQ0wsdUJBQXVCLEVBQ3ZCLFNBQVMsRUFBRSxZQUFZLEVBQUUsS0FBSyxFQUFhLE1BQU0sR0FDbEQsTUFBTSxlQUFlLENBQUM7QUFNdkIsT0FBTyxFQUNMLHdCQUF3QixHQUN6QixNQUFNLGtEQUFrRCxDQUFDO0FBQzFELE9BQU8sRUFBQyxnQkFBZ0IsRUFBQyxNQUFNLDJCQUEyQixDQUFDO0FBQzNELE9BQU8sRUFBQyxlQUFlLEVBQUMsTUFBTSwwQkFBMEIsQ0FBQztBQUN6RCxPQUFPLEVBQUMsYUFBYSxFQUFDLE1BQU0sd0JBQXdCLENBQUM7QUFDckQsT0FBTyxFQUFDLGVBQWUsRUFBQyxNQUFNLCtCQUErQixDQUFDO0FBQzlELE9BQU8sRUFBQyxRQUFRLEVBQUUsZ0JBQWdCLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQzs7Ozs7Ozs7QUFvQjNELE1BQU0sT0FBTywyQkFBMkI7SUF3QnRDLFlBQ1UsU0FBb0IsRUFDcEIsSUFBMEIsRUFDMUIsY0FBc0M7UUFGdEMsY0FBUyxHQUFULFNBQVMsQ0FBVztRQUNwQixTQUFJLEdBQUosSUFBSSxDQUFzQjtRQUMxQixtQkFBYyxHQUFkLGNBQWMsQ0FBd0I7UUFwQmhEOzs7V0FHRztRQUVNLFdBQU0sR0FBNEIsSUFBSSxZQUFZLEVBQWEsQ0FBQztRQU96RTs7V0FFRztRQUNILGlCQUFZLEdBQUcsS0FBSyxDQUFDO0lBTWxCLENBQUM7SUFFSixXQUFXO1FBQ1QsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJO1lBQUUsT0FBTztRQUV2Qjs7V0FFRztRQUNILE1BQU0sT0FBTyxHQUFHLElBQUksQ0FBQyxjQUFjLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsUUFBUSxDQUFDLENBQUM7UUFDL0QsSUFBSSxDQUFDLGNBQWMsQ0FBQyxjQUFjLENBQUMsT0FBTyxDQUFDO2FBQ3RDLElBQUksQ0FBQyxDQUFDLFdBQVcsRUFBRSxFQUFFO1lBQ3BCLElBQUksQ0FBQyxZQUFZLEdBQUcsS0FBSyxDQUFDO1lBQzFCLElBQUksQ0FBQyxXQUFXLEdBQUcsV0FBVyxDQUFDO1FBQ2pDLENBQUMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxDQUFDLEtBQW9CLEVBQUUsRUFBRTtZQUNoQyxJQUFJLENBQUMsSUFBSSxDQUFDLEtBQUssQ0FDWCxtQ0FBbUMsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLEdBQUcsRUFDckQsS0FBSyxFQUNMLElBQUksQ0FBQyxJQUFJLENBQ1osQ0FBQztRQUNKLENBQUMsQ0FBQyxDQUFDO0lBQ1QsQ0FBQztJQUVEOztPQUVHO0lBQ0gsWUFBWTtRQUNWLElBQUksQ0FBQyxNQUFNLENBQUMsSUFBSSxDQUFDLFNBQVMsQ0FBQyxDQUFDO0lBQzlCLENBQUM7SUFFRCxNQUFNO1FBQ0osSUFBSSxJQUFJLENBQUMsV0FBVyxFQUFFLENBQUM7WUFDckIsTUFBTSxPQUFPLEdBQUcsSUFBSSxDQUFDLFNBQVMsQ0FBQyxJQUFJLENBQUMsSUFBSSxDQUFDLFdBQVcsQ0FBQyxDQUFDO1lBQ3RELElBQUksT0FBTztnQkFBRSxJQUFJLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxxQkFBcUIsQ0FBQyxDQUFDOztnQkFDOUMsSUFBSSxDQUFDLElBQUksQ0FBQyxJQUFJLENBQUMsNEJBQTRCLENBQUMsQ0FBQztRQUNwRCxDQUFDO0lBQ0gsQ0FBQzs4R0EvRFUsMkJBQTJCO2tHQUEzQiwyQkFBMkIsbUtDcEN4Qyx5K0RBZ0VBLGd2QkR0Q0ksd0JBQXdCLG1HQUN4QixnQkFBZ0IsNFRBQ2hCLGVBQWUscWZBQ2YsYUFBYSwrS0FDYixlQUFlLCtDQUNmLFFBQVEsNkNBQ1IsZ0JBQWdCOzsyRkFJUCwyQkFBMkI7a0JBaEJ2QyxTQUFTOytCQUNFLDJCQUEyQixjQUd6QixJQUFJLFdBQ1A7d0JBQ1Asd0JBQXdCO3dCQUN4QixnQkFBZ0I7d0JBQ2hCLGVBQWU7d0JBQ2YsYUFBYTt3QkFDYixlQUFlO3dCQUNmLFFBQVE7d0JBQ1IsZ0JBQWdCO3FCQUNqQixtQkFDZ0IsdUJBQXVCLENBQUMsTUFBTTtzSkFPN0MsSUFBSTtzQkFETCxLQUFLO2dCQVFHLE1BQU07c0JBRGQsTUFBTSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7XG4gIENoYW5nZURldGVjdGlvblN0cmF0ZWd5LFxuICBDb21wb25lbnQsIEV2ZW50RW1pdHRlciwgSW5wdXQsIE9uQ2hhbmdlcywgT3V0cHV0LFxufSBmcm9tICdAYW5ndWxhci9jb3JlJztcbmltcG9ydCB7U3RvcmFnZUZpbGV9IGZyb20gJy4uLy4uL2ludGVyZmFjZXMnO1xuaW1wb3J0IHtcbiAgRmlyZWJhc2VTdG9yYWdlU2VydmljZSxcbn0gZnJvbSAnLi4vLi4vc2VydmljZXMvZmlyZWJhc2Utc3RvcmFnZS5zZXJ2aWNlJztcbmltcG9ydCB7RmlyZWJhc2VFcnJvcn0gZnJvbSAnQGFuZ3VsYXIvZmlyZS9hcHAvZmlyZWJhc2UnO1xuaW1wb3J0IHtcbiAgU3RvcmFnZUl0ZW1JY29uQ29tcG9uZW50LFxufSBmcm9tICcuLi9zdG9yYWdlLWl0ZW0taWNvbi9zdG9yYWdlLWl0ZW0taWNvbi5jb21wb25lbnQnO1xuaW1wb3J0IHtNYXRUb29sdGlwTW9kdWxlfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC90b29sdGlwJztcbmltcG9ydCB7TWF0QnV0dG9uTW9kdWxlfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9idXR0b24nO1xuaW1wb3J0IHtNYXRJY29uTW9kdWxlfSBmcm9tICdAYW5ndWxhci9tYXRlcmlhbC9pY29uJztcbmltcG9ydCB7Rm9ybWF0Qnl0ZXNQaXBlfSBmcm9tICcuLi8uLi9waXBlcy9mb3JtYXQtYnl0ZXMucGlwZSc7XG5pbXBvcnQge0RhdGVQaXBlLCBOZ09wdGltaXplZEltYWdlfSBmcm9tICdAYW5ndWxhci9jb21tb24nO1xuaW1wb3J0IHtDb25zb2xlTG9nZ2VyU2VydmljZX0gZnJvbSAnLi4vLi4vc2VydmljZXMvY29uc29sZS1sb2dnZXIuc2VydmljZSc7XG5pbXBvcnQge0NsaXBib2FyZH0gZnJvbSAnQGFuZ3VsYXIvY2RrL2NsaXBib2FyZCc7XG5cbkBDb21wb25lbnQoe1xuICBzZWxlY3RvcjogJ2Fub24tc3RvcmFnZS1maWxlLXByZXZpZXcnLFxuICB0ZW1wbGF0ZVVybDogJy4vc3RvcmFnZS1maWxlLXByZXZpZXcuY29tcG9uZW50Lmh0bWwnLFxuICBzdHlsZVVybDogJy4vc3RvcmFnZS1maWxlLXByZXZpZXcuY29tcG9uZW50LnNjc3MnLFxuICBzdGFuZGFsb25lOiB0cnVlLFxuICBpbXBvcnRzOiBbXG4gICAgU3RvcmFnZUl0ZW1JY29uQ29tcG9uZW50LFxuICAgIE1hdFRvb2x0aXBNb2R1bGUsXG4gICAgTWF0QnV0dG9uTW9kdWxlLFxuICAgIE1hdEljb25Nb2R1bGUsXG4gICAgRm9ybWF0Qnl0ZXNQaXBlLFxuICAgIERhdGVQaXBlLFxuICAgIE5nT3B0aW1pemVkSW1hZ2UsXG4gIF0sXG4gIGNoYW5nZURldGVjdGlvbjogQ2hhbmdlRGV0ZWN0aW9uU3RyYXRlZ3kuT25QdXNoLFxufSlcbmV4cG9ydCBjbGFzcyBTdG9yYWdlRmlsZVByZXZpZXdDb21wb25lbnQgaW1wbGVtZW50cyBPbkNoYW5nZXMge1xuICAvKipcbiAgICogVGhlIFN0b3JhZ2VGaWxlIG9iamVjdCByZXByZXNlbnRpbmcgdGhlIGZpbGUgdG8gcHJldmlldy5cbiAgICovXG4gIEBJbnB1dCgpXG4gICAgaXRlbT86IFN0b3JhZ2VGaWxlO1xuXG4gIC8qKlxuICAgKiBFbWl0cyBhbiBldmVudCB3aGVuIHRoZSBwcmV2aWV3IHNob3VsZCBiZSBjbG9zZWQuXG4gICAqIEBldmVudFxuICAgKi9cbiAgQE91dHB1dCgpXG4gIHJlYWRvbmx5IF9jbG9zZTogRXZlbnRFbWl0dGVyPHVuZGVmaW5lZD4gPSBuZXcgRXZlbnRFbWl0dGVyPHVuZGVmaW5lZD4oKTtcblxuICAvKipcbiAgICogVGhlIGRvd25sb2FkIFVSTCBmb3IgdGhlIHByZXZpZXdlZCBmaWxlIChpZiBzdWNjZXNzZnVsbHkgZ2VuZXJhdGVkKS5cbiAgICovXG4gIGRvd25sb2FkVVJMPzogc3RyaW5nO1xuXG4gIC8qKlxuICAgKiBJbmRpY2F0ZXMgd2hldGhlciBhbiBlcnJvciBvY2N1cnJlZCB3aGlsZSBnZW5lcmF0aW5nIHRoZSBmaWxlIHByZXZpZXcgVVJMLlxuICAgKi9cbiAgcHJldmlld0Vycm9yID0gZmFsc2U7XG5cbiAgY29uc3RydWN0b3IoXG4gICAgcHJpdmF0ZSBjbGlwYm9hcmQ6IENsaXBib2FyZCxcbiAgICBwcml2YXRlIGNMb2c6IENvbnNvbGVMb2dnZXJTZXJ2aWNlLFxuICAgIHByaXZhdGUgc3RvcmFnZVNlcnZpY2U6IEZpcmViYXNlU3RvcmFnZVNlcnZpY2UsXG4gICkge31cblxuICBuZ09uQ2hhbmdlcygpIHtcbiAgICBpZiAoIXRoaXMuaXRlbSkgcmV0dXJuO1xuXG4gICAgLyoqXG4gICAgICogRmV0Y2hlcyB0aGUgZG93bmxvYWQgVVJMIGZvciB0aGUgbmV3IGZpbGUgYW5kIHVwZGF0ZXMgdGhlIHByZXZpZXcgc3RhdGUuXG4gICAgICovXG4gICAgY29uc3QgZmlsZVJlZiA9IHRoaXMuc3RvcmFnZVNlcnZpY2UuZ2V0UmVmKHRoaXMuaXRlbS5mdWxsUGF0aCk7XG4gICAgdGhpcy5zdG9yYWdlU2VydmljZS5nZXREb3dubG9hZFVSTChmaWxlUmVmKVxuICAgICAgICAudGhlbigoZG93bmxvYWRVUkwpID0+IHtcbiAgICAgICAgICB0aGlzLnByZXZpZXdFcnJvciA9IGZhbHNlO1xuICAgICAgICAgIHRoaXMuZG93bmxvYWRVUkwgPSBkb3dubG9hZFVSTDtcbiAgICAgICAgfSkuY2F0Y2goKGVycm9yOiBGaXJlYmFzZUVycm9yKSA9PiB7XG4gICAgICAgICAgdGhpcy5jTG9nLmVycm9yKFxuICAgICAgICAgICAgICBgRXJyb3IgZ2V0dGluZyBkb3dubG9hZCBVUkwgZm9yICcke3RoaXMuaXRlbT8ubmFtZX0nYCxcbiAgICAgICAgICAgICAgZXJyb3IsXG4gICAgICAgICAgICAgIHRoaXMuaXRlbSxcbiAgICAgICAgICApO1xuICAgICAgICB9KTtcbiAgfVxuXG4gIC8qKlxuICAgKiBFbWl0cyB0aGUgJ19jbG9zZScgZXZlbnQgdG8gc2lnbmFsIHRoYXQgdGhlIHByZXZpZXcgc2hvdWxkIGJlIGNsb3NlZC5cbiAgICovXG4gIGNsb3NlUHJldmlldygpIHtcbiAgICB0aGlzLl9jbG9zZS5lbWl0KHVuZGVmaW5lZCk7XG4gIH1cblxuICBvbkNvcHkoKSB7XG4gICAgaWYgKHRoaXMuZG93bmxvYWRVUkwpIHtcbiAgICAgIGNvbnN0IHN1Y2Nlc3MgPSB0aGlzLmNsaXBib2FyZC5jb3B5KHRoaXMuZG93bmxvYWRVUkwpO1xuICAgICAgaWYgKHN1Y2Nlc3MpIHRoaXMuY0xvZy5pbmZvKCdDb3BpZWQgdG8gY2xpcGJvYXJkJyk7XG4gICAgICBlbHNlIHRoaXMuY0xvZy5pbmZvKCdFcnJvciBjb3B5aW5nIHRvIGNsaXBib2FyZCcpO1xuICAgIH1cbiAgfVxufVxuIiwiQGlmIChpdGVtKSB7XG4gIDxkaXYgY2xhc3M9XCJoZWFkZXJcIj5cbiAgICA8ZGl2IGNsYXNzPVwibmFtZVwiPlxuICAgICAgPGFub24tc3RvcmFnZS1pdGVtLWljb24gW3R5cGVdPVwiaXRlbS50eXBlIVwiIFtjb250ZW50VHlwZV09XCJpdGVtLmNvbnRlbnRUeXBlIVwiIC8+XG4gICAgICA8c3BhbiBtYXRUb29sdGlwU2hvd0RlbGF5PVwiNTAwXCIgW21hdFRvb2x0aXBdPVwiaXRlbS5uYW1lXCI+e3tpdGVtLm5hbWV9fTwvc3Bhbj5cbiAgICA8L2Rpdj5cblxuICAgIDxidXR0b24gbWF0LWljb24tYnV0dG9uIHR5cGU9XCJidXR0b25cIiAoY2xpY2spPVwiY2xvc2VQcmV2aWV3KClcIj5cbiAgICAgIDxtYXQtaWNvbiBmb250SWNvbj1cImNsb3NlXCIgLz5cbiAgICA8L2J1dHRvbj5cbiAgPC9kaXY+XG5cbiAgQGlmIChkb3dubG9hZFVSTCkge1xuICAgICBcbiAgICBAaWYgKGl0ZW0uY29udGVudFR5cGU/LnN0YXJ0c1dpdGgoJ2ltYWdlLycpKSB7XG4gICAgICA8cGljdHVyZSBjbGFzcz1cImZpbGUtcHJldmlld1wiPlxuICAgICAgICA8aW1nIGZpbGwgW25nU3JjXT1cImRvd25sb2FkVVJMXCIgW2FsdF09XCJpdGVtLmZ1bGxQYXRoXCJcbiAgICAgICAgICAgICAoZXJyb3IpPVwiZG93bmxvYWRVUkw9dW5kZWZpbmVkO3ByZXZpZXdFcnJvcj10cnVlXCIgLz5cbiAgICAgIDwvcGljdHVyZT5cbiAgICAgICBcbiAgICB9IEBlbHNlIGlmIChpdGVtLmNvbnRlbnRUeXBlPy5zdGFydHNXaXRoKCd2aWRlby8nKSkge1xuICAgICAgPHZpZGVvIGNsYXNzPVwiZmlsZS1wcmV2aWV3XCIgY29udHJvbHMgYXV0b3BsYXkgbG9vcD5cbiAgICAgICAgPHNvdXJjZSBbdHlwZV09XCJpdGVtLmNvbnRlbnRUeXBlXCIgW3NyY109XCJkb3dubG9hZFVSTFwiXG4gICAgICAgICAgICAgICAgKGVycm9yKT1cImRvd25sb2FkVVJMPXVuZGVmaW5lZDtwcmV2aWV3RXJyb3I9dHJ1ZVwiLz5cbiAgICAgIDwvdmlkZW8+XG4gICAgfVxuXG4gICAgPGRpdiBjbGFzcz1cImJ0bi1jb250YWluZXJcIj5cbiAgICAgIDxkaXYgY2xhc3M9XCJkb3dubG9hZC1idG5cIj5cbiAgICAgICAgPGEgbWF0LXN0cm9rZWQtYnV0dG9uIHR5cGU9XCJidXR0b25cIiBjb2xvcj1cInByaW1hcnlcIiB0YXJnZXQ9XCJfYmxhbmtcIiBbaHJlZl09XCJkb3dubG9hZFVSTFwiPlxuICAgICAgICAgIDxtYXQtaWNvbiBmb250SWNvbj1cImRvd25sb2FkXCIgLz5cbiAgICAgICAgICA8c3Bhbj5Eb3dubG9hZDwvc3Bhbj5cbiAgICAgICAgPC9hPlxuICAgICAgPC9kaXY+XG5cbiAgICAgIDxkaXYgY2xhc3M9XCJjb3B5LWJ0blwiPlxuICAgICAgICA8YnV0dG9uIG1hdC1zdHJva2VkLWJ1dHRvbiB0eXBlPVwiYnV0dG9uXCIgY29sb3I9XCJwcmltYXJ5XCIgKGNsaWNrKT1cIm9uQ29weSgpXCI+XG4gICAgICAgICAgPG1hdC1pY29uIGZvbnRJY29uPVwiZmlsZV9jb3B5XCIgLz5cbiAgICAgICAgICA8c3Bhbj5Db3B5PC9zcGFuPlxuICAgICAgICA8L2J1dHRvbj5cbiAgICAgIDwvZGl2PlxuICAgIDwvZGl2PlxuICB9XG4gIEBpZiAocHJldmlld0Vycm9yKSB7XG4gICAgPGgzIGNsYXNzPVwiZmlsZS1wcmV2aWV3XCI+UHJldmlldyBOb3QgQXZhaWxhYmxlLjwvaDM+XG4gIH1cblxuICA8ZGwgY2xhc3M9XCJtZXRhZGF0YVwiPlxuICAgIDxkdD5OYW1lPC9kdD5cbiAgICA8ZGQ+PGEgY2xhc3M9XCJkb3dubG9hZC1saW5rXCIgdGFyZ2V0PVwiX2JsYW5rXCIgW2hyZWZdPVwiZG93bmxvYWRVUkxcIj57e2l0ZW0ubmFtZX19PC9hPjwvZGQ+XG5cbiAgICA8ZHQ+U2l6ZTwvZHQ+XG4gICAgPGRkPnt7aXRlbS5zaXplIHwgZm9ybWF0Qnl0ZXN9fTwvZGQ+XG5cbiAgICA8ZHQ+VHlwZTwvZHQ+XG4gICAgPGRkPnt7aXRlbS5jb250ZW50VHlwZX19PC9kZD5cblxuICAgIDxkdD5DcmVhdGVkPC9kdD5cbiAgICA8ZGQ+e3tpdGVtLnRpbWVDcmVhdGVkIHwgZGF0ZTonc2hvcnQnfX08L2RkPlxuXG4gICAgPGR0Pkxhc3QgbW9kaWZpZWQ8L2R0PlxuICAgIDxkZD57e2l0ZW0udXBkYXRlZCB8IGRhdGU6J3Nob3J0J319PC9kZD5cbiAgPC9kbD5cbn1cbiJdfQ==